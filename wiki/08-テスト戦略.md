# ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

## ç¾çŠ¶

- ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª/ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒªãƒã‚¸ãƒˆãƒªå†…ã«å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
- å“è³ªç¢ºèªã¯æ‰‹å‹•ã®ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆã¨ãƒ­ã‚°ç¢ºèªãŒä¸­å¿ƒã§ã™ã€‚

## ç›®æ¨™ãƒ†ã‚¹ãƒˆæ§‹æˆï¼ˆæ¨å¥¨ï¼‰

```mermaid
flowchart TD
  Unit[Unit Tests] --> Integration[Integration Tests]
  Integration --> E2E[E2E Tests]
```

## é‡ç‚¹ãƒ†ã‚¹ãƒˆé ˜åŸŸ

### 1. API ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- `/api/course-reviews` ã®å…¥åŠ›ãƒã‚§ãƒƒã‚¯ã¨ DB åˆ¶ç´„ã®æ•´åˆæ€§ã€‚
- `/api/company-reviews` ã® outcome/selection_types ã®ãƒã‚§ãƒƒã‚¯ã€‚

```ts
if (form.academicYear < 1990 || form.academicYear > 2100) return false; // å¹´åº¦ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
```
(å‚ç…§: apps/review-page/app/course_reviews/page.tsx:415-416)

### 2. AIåˆ¤å®šãƒ•ãƒ­ãƒ¼
- `/api/review-moderation` ã® JSON å½¢å¼ãƒ‘ãƒ¼ã‚¹ãŒå¤±æ•—ã—ãŸå ´åˆã® fallbackã€‚

```ts
try {
  parsed = JSON.parse(outputText);
} catch {
  parsed = null; // JSON å¤±æ•—æ™‚ã¯ null æ‰±ã„
}
```
(å‚ç…§: apps/review-page/app/api/review-moderation/route.ts:114-120)

### 3. ãƒãƒƒãƒå‡¦ç†
- `embedding_jobs` ã®ãƒ­ãƒƒã‚¯å‡¦ç†ã¨ãƒªãƒˆãƒ©ã‚¤ã€‚

```ts
const staleBefore = new Date(Date.now() - LOCK_STALE_MINUTES * 60 * 1000).toISOString(); // stale ãƒ­ãƒƒã‚¯
```
(å‚ç…§: apps/review-page/app/api/batch/embeddings/run/route.ts:116)

## ãƒ†ã‚¹ãƒˆå®Ÿæ–½ã®å…¥å£

- lint: `npm run lint`
- æ‰‹å‹•ã‚¹ãƒ¢ãƒ¼ã‚¯: LINE â†’ è¿”ä¿¡ã€ãƒ•ã‚©ãƒ¼ãƒ æŠ•ç¨¿ â†’ DB åæ˜ ã€subject-browser ã®æ¤œç´¢

```jsonc
{
  "scripts": {
    "lint": "next lint" // é™çš„è§£æ
  }
}
```
(å‚ç…§: apps/review-page/package.json:5-10)

æ¬¡ã«é€²ã‚€å ´åˆã¯ [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](./09-ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
